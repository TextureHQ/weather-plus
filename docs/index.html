<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Weather Plus Documentation</title>
    <meta
      name="description"
      content="Developer documentation for Weather Plus, a TypeScript SDK that normalizes multiple weather providers behind a single API."
    />
    <link rel="stylesheet" href="https://unpkg.com/@picocss/pico@2.0.6/css/pico.min.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-typescript.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js" defer></script>
    <style>
      :root {
        --brand: #1d4ed8;
        --brand-soft: #dbeafe;
        --text: #0b1120;
        --text-muted: #4b5563;
        --background: #f8fafc;
      }

      body {
        background: var(--background);
        color: var(--text);
        margin: 0;
      }

      main.container {
        max-width: 980px;
        margin: 0 auto 4rem;
        padding: 0 1.6rem 4rem;
      }

      header.hero {
        padding-top: 3rem;
      }

      header.hero .tag {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 999px;
        background: var(--brand-soft);
        color: var(--brand);
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.06em;
      }

      header.hero h1 {
        font-size: clamp(2.8rem, 4vw, 3.6rem);
        margin: 1rem 0 0.75rem;
        font-weight: 700;
        color: var(--text);
      }

      header.hero h2 {
        font-size: clamp(1.4rem, 2.5vw, 1.8rem);
        font-weight: 500;
        margin: 0.25rem 0 0.9rem;
        color: var(--text-muted);
      }

      header.hero p.lede {
        font-size: 1.05rem;
        color: var(--text-muted);
        max-width: 720px;
        line-height: 1.6;
      }

      .texture-brand {
        margin-top: 1.2rem;
        display: inline-flex;
        align-items: center;
        gap: 0.6rem;
        color: var(--text-muted);
      }

      .texture-brand img {
        height: 26px;
      }

      .cta-buttons {
        margin-top: 1.8rem;
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .cta-buttons a {
        padding: 0.7rem 1.5rem;
        border-radius: 999px;
        font-weight: 600;
        border: 1px solid transparent;
        transition: transform 0.1s ease, box-shadow 0.1s ease;
      }

      .cta-buttons a:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 20px rgba(29, 78, 216, 0.15);
      }

      .cta-buttons a.secondary {
        background: var(--brand-soft);
        color: var(--brand);
        border: 1px solid rgba(29, 78, 216, 0.25);
      }

      .cta-buttons a.contrast {
        background: var(--brand);
        color: white;
      }

      .cta-buttons a.outline {
        background: #ffffff;
        color: var(--text);
        border: 1px solid rgba(15, 17, 32, 0.15);
      }

      section {
        margin-top: 3.5rem;
      }

      section h2 {
        font-size: 2rem;
        margin-bottom: 1.1rem;
        color: var(--text);
      }

      p.description {
        color: var(--text-muted);
        max-width: 760px;
        line-height: 1.6;
      }

      pre {
        background: #111827;
        color: #e2e8f0;
        border-radius: 0.9rem;
        padding: 1.1rem 1.25rem;
        overflow-x: auto;
        font-size: 0.95rem;
        box-shadow: 0 12px 32px rgba(15, 23, 42, 0.25);
      }

      .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.4rem;
      }

      .feature-card {
        border: 1px solid #e2e8f0;
        border-radius: 0.9rem;
        padding: 1.4rem;
        background: #ffffff;
        box-shadow: 0 10px 24px rgba(15, 23, 42, 0.05);
      }

      .feature-card h3 {
        margin-bottom: 0.65rem;
        font-size: 1.1rem;
        color: var(--text);
      }

      .feature-card p {
        color: var(--text-muted);
        line-height: 1.6;
      }

      ul.checklist {
        list-style: none;
        padding-left: 0;
      }

      ul.checklist li {
        position: relative;
        padding-left: 1.8rem;
        margin-bottom: 0.75rem;
        color: var(--text-muted);
        line-height: 1.6;
      }

      ul.checklist li::before {
        content: '✓';
        position: absolute;
        left: 0;
        top: 0;
        color: var(--brand);
        font-weight: 700;
      }

      table {
        border-radius: 0.9rem;
        overflow: hidden;
        box-shadow: 0 12px 32px rgba(15, 23, 42, 0.08);
        background: #ffffff;
        border: 1px solid rgba(15, 23, 42, 0.08);
      }

      table th,
      table td {
        font-size: 0.95rem;
        color: var(--text);
        background: #ffffff;
      }

      table thead th {
        background: var(--brand-soft);
        font-weight: 600;
      }

            table tbody tr:nth-child(odd) {
        background: #f8fafc;
      }

      footer {
        margin: 4rem 0 2rem;
        text-align: center;
        color: var(--text-muted);
      }

      footer .texture-wordmark {
        display: inline-flex;
        align-items: center;
        gap: 0.6rem;
      }

      footer .texture-wordmark img {
        height: 22px;
      }

      @media (max-width: 768px) {
        header.hero {
          padding-top: 2rem;
        }

        .cta-buttons {
          flex-direction: column;
          align-items: flex-start;
        }

        .texture-brand img {
          height: 22px;
        }
      }
    </style>
  </head>
  <body>
    <main class="container">
      <header class="hero">
        <span class="tag">Documentation</span>
        <h1>Weather Plus</h1>
        <h2>Typed weather data from multiple providers, one API.</h2>
        <p class="lede">
          Weather Plus unifies NWS, OpenWeather, Tomorrow.io, and Weatherbit into a
          single contract—reshaping payloads, condition codes, and errors so your
          application stays consistent even when providers change.
        </p>
        <div class="texture-brand">
          Built by
          <a href="https://www.texturehq.com" target="_blank" rel="noopener">
            <img src="https://cdn.texturehq.com/texture-wordmark-black.png" alt="Texture" />
          </a>
        </div>
        <div class="cta-buttons">
          <a class="outline" href="https://www.npmjs.com/package/weather-plus">View on npm</a>
          <a class="contrast" href="https://github.com/TextureHQ/weather-plus">GitHub repository</a>
        </div>
      </header>

      <section>
        <h2>Install</h2>
        <pre><code class="language-bash">yarn add weather-plus
# or
npm install weather-plus</code></pre>
      </section>

      <section>
        <h2>First request</h2>
        <p class="description">
          Create the SDK, supply the providers you care about, and ask for data at a
          latitude / longitude. Weather Plus will try providers in order and return
          as soon as one succeeds.
        </p>
        <pre><code class="language-ts">import WeatherPlus from 'weather-plus';

const client = new WeatherPlus({
  providers: ['weatherbit', 'openweather', 'nws'],
  apiKeys: {
    weatherbit: process.env.WEATHERBIT_API_KEY!,
    openweather: process.env.OPENWEATHER_API_KEY!,
  },
});

const report = await client.getWeather(40.7128, -74.0060);

console.log(report.temperature?.value); // → number in °C by default (see `unit`)
console.log(report.conditions?.value);  // → standardized enum string
console.log(report.provider);            // → 'weatherbit'
</code></pre>
      </section>

      <section>
        <h2>Normalized weather schema</h2>
        <p class="description">
          All providers are transformed into the same TypeScript contract. The
          shared schema lives in <code>src/interfaces.ts</code> if you need to dig
          deeper.
        </p>
        <pre><code class="language-ts">export interface IWeatherData {
  provider: string;
  cached: boolean;
  cachedAt?: string; // ISO-8601 timestamp when served from cache
  temperature?: { value: number; unit: 'C' | 'F' };
  humidity?: { value: number; unit: 'percent' };
  dewPoint?: { value: number; unit: 'C' | 'F' };
  cloudiness?: { value: number; unit: 'percent' };
  conditions?: { value: string; unit: 'string'; original?: string };
}
</code></pre>
      </section>

      <section>
        <h2>Provider fallback &amp; timeouts</h2>
        <p class="description">
          Provide an ordered list of providers. Optional <code>timeout</code>
          controls how long each provider is given before the next one is tried. If omitted, Axios waits indefinitely (no default timeout).
        </p>
        <pre><code class="language-ts">const client = new WeatherPlus({
  providers: ['openweather', 'tomorrow', 'weatherbit'],
  apiKeys: {
    openweather: process.env.OPENWEATHER_API_KEY!,
    tomorrow: process.env.TOMORROW_API_KEY!,
    weatherbit: process.env.WEATHERBIT_API_KEY!,
  },
  timeout: 4000, // 4s per provider before falling back (default is no timeout)
});
</code></pre>
      </section>

      <section>
        <h2>Caching strategies</h2>
        <div class="feature-grid">
          <article class="feature-card">
            <h3>In-memory (default)</h3>
            <p>
              Every Weather Plus instance ships with an in-memory cache using
              geohash keys. Nearby lookups map to the same cell, keeping payloads
              compact while delivering high hit rates for city-centric requests.
            </p>
          </article>
          <article class="feature-card">
            <h3>Redis</h3>
            <p>
              Provide a Redis client to share cache between processes or hosts.
              Configure TTL and geohash precision to balance freshness and hit rate.
            </p>
          </article>
        </div>
        <p class="description">
          Each cache key is derived from the request geohash (default precision 5).
          Increase the precision for block-by-block accuracy or lower it to share
          results across larger regions. TTL controls freshness regardless of
          provider response headers.
        </p>
        <pre><code class="language-ts">import { createClient } from 'redis';

const redis = createClient({ url: process.env.REDIS_URL });
await redis.connect();

const client = new WeatherPlus({
  providers: ['weatherbit', 'nws'],
  apiKeys: { weatherbit: process.env.WEATHERBIT_API_KEY! },
  redisClient: redis,
  cacheTTL: 900,        // seconds
  geohashPrecision: 6,  // tighter cells for metropolitan areas
});
</code></pre>
      </section>

      <section>
        <h2>Runtime options</h2>
        <pre><code class="language-ts">// Bypass cache for a single call
await client.getWeather(lat, lng, { bypassCache: true });

// Change geohash precision (1–20)
const regionalClient = new WeatherPlus({
  providers: ['openweather'],
  apiKeys: { openweather: process.env.OPENWEATHER_API_KEY! },
  geohashPrecision: 4, // wider cells for national coverage
});
</code></pre>
      </section>

      <section>
        <h2>Error taxonomy</h2>
        <p class="description">
          Weather Plus wraps provider errors in a shared hierarchy. You can inspect
          the instance type or code to decide whether to retry, back off, or open a
          circuit.
        </p>
        <pre><code class="language-ts">import {
  InvalidProviderLocationError,
  WeatherProviderError,
} from 'weather-plus/dist/cjs/errors';

try {
  await client.getWeather(lat, lng);
} catch (error) {
  if (error instanceof InvalidProviderLocationError) {
    // Provider never supports this lat/lng (e.g., NWS outside the US)
  }

  if (error instanceof WeatherProviderError) {
    console.error(error.provider, error.code, error.cause);
    // -> code: 'UpstreamError' | 'UnavailableError' | 'ValidationError' | etc.
  }
}
</code></pre>
      </section>

      <section>
        <h2>Outcome reporters</h2>
        <p class="description">
          Hook into the provider lifecycle for metrics or logging. Every call emits
          a success/failure event with latency and error taxonomy.
        </p>
        <pre><code class="language-ts">import {
  ProviderOutcomeReporter,
  setDefaultOutcomeReporter,
} from 'weather-plus/dist/cjs/providers/outcomeReporter';

const reporter: ProviderOutcomeReporter = {
  record(provider, outcome) {
    if (outcome.ok) {
      console.log(`[${provider}] success in ${outcome.latencyMs}ms`);
    } else {
      console.error(
        `[${provider}] failed (${outcome.code}) after ${outcome.latencyMs}ms`,
      );
    }
  },
};

setDefaultOutcomeReporter(reporter);
</code></pre>
      </section>

      <section>
        <h2>Provider capabilities</h2>
        <table>
          <thead>
            <tr>
              <th>Provider</th>
              <th>API key</th>
              <th>Region</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><a href="https://weather-gov.github.io/api/" target="_blank">National Weather Service (NWS)</a></td>
              <td>No</td>
              <td>United States</td>
              <td>Free, but limited to US lat/lng and rate-limited by policy.</td>
            </tr>
            <tr>
              <td><a href="https://openweathermap.org/api" target="_blank">OpenWeather</a></td>
              <td>Yes</td>
              <td>Global</td>
              <td>Supports free and paid tiers with robust forecast data.</td>
            </tr>
            <tr>
              <td><a href="https://www.tomorrow.io/" target="_blank">Tomorrow.io</a></td>
              <td>Yes</td>
              <td>Global</td>
              <td>Realtime conditions with rich metadata and enterprise plans.</td>
            </tr>
            <tr>
              <td><a href="https://www.weatherbit.io/" target="_blank">Weatherbit</a></td>
              <td>Yes</td>
              <td>Global</td>
              <td>Simple paid plans, great for realtime conditions.</td>
            </tr>
          </tbody>
        </table>
      </section>

      <section>
        <h2>Helpful links</h2>
        <ul>
          <li>
            <a href="https://github.com/TextureHQ/weather-plus#readme" target="_blank"
              >Project README</a
            >
          </li>
          <li>
            <a href="https://github.com/TextureHQ/weather-plus/tree/main/docs/rfcs"
              target="_blank"
              >RFCs &amp; architecture decisions</a
            >
          </li>
          <li>
            <a href="https://www.npmjs.com/package/weather-plus" target="_blank"
              >npm package details</a
            >
          </li>
        </ul>
      </section>
    </main>

    <footer>
      <span class="texture-wordmark">
        Built with ❤️ in NYC by
        <a href="https://www.texturehq.com" target="_blank" rel="noopener">
          <img src="https://cdn.texturehq.com/texture-wordmark-black.png" alt="Texture" />
        </a>
      </span>
      &middot;
      <a href="https://github.com/TextureHQ/weather-plus">Contribute on GitHub</a>
    </footer>
  </body>
</html>
